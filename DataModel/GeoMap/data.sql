CREATE TABLE
IF NOT EXISTS census_variables
(
    name VARCHAR
(40),
    description TEXT,
    PRIMARY KEY
(name)
);

CREATE TYPE geo_type AS ENUM
('city', 'zip', 'county');

CREATE TABLE
IF NOT EXISTS census_data
(
    variable_name VARCHAR
(40),
    year INT,
    geo_type geo_type,
    geo_name VARCHAR
(100),
    value INT,
    FOREIGN KEY
(variable_name) REFERENCES census_variables
(name),
    PRIMARY KEY
(variable_name, year, geo_name)
);

DROP TABLE IF EXISTS zip_code;
DROP TABLE IF EXISTS zip_area;
DROP TABLE IF EXISTS area;
DROP TABLE IF EXISTS location;

CREATE TABLE
IF NOT EXISTS zip_code
(
    zip INT,
    coordinates int[],
    PRIMARY KEY
(zip)
);

CREATE TABLE
IF NOT EXISTS area
(
    name VARCHAR,
    coordinates int[],
    PRIMARY KEY
(name)
);

CREATE TABLE
IF NOT EXISTS zip_area
(
    zip INT,
    area VARCHAR,
    FOREIGN KEY
(zip) REFERENCES zip_code
(zip),
    FOREIGN KEY
(area) REFERENCES area
(name),
    PRIMARY KEY
(zip, area)
);

CREATE TABLE
IF NOT EXISTS point
(
    id INT,
    longitude REAL,
    latitude REAL,
    primary key
(id)
);

CREATE TABLE
IF NOT EXISTS location
(
    name VARCHAR,
    table_name VARCHAR,
    point_id INT,
    FOREIGN KEY
(point_id) REFERENCES point
(id),
    FOREIGN KEY
(table_name) REFERENCES datasetmetadata
(tablename),
    PRIMARY KEY
(name, table_name)
);

insert into datasetmetadata
    (tablename, columnnames, datatypes)
values
    ('census_data', ARRAY
['variable_name', 'year', 'geo_type', 'geo_name', 'value'],
ARRAY['string', 'int', 'string', 'string', 'int'])

INSERT INTO zip_code
VALUES
    (93428, ARRAY [
          ARRAY [-121.12786764474501, 35.594866374176696],
          ARRAY [-121.125593, 35.595427],
          ARRAY [-121.12764199999998, 35.598861],
          ARRAY [-121.122304, 35.599754],
          ARRAY [-121.123989, 35.611579],
          ARRAY [-121.12178899999999, 35.613671],
          ARRAY [-121.119857, 35.613461],
          ARRAY [-121.114018, 35.619614999999996],
          ARRAY [-121.117086, 35.618412],
          ARRAY [-121.117927, 35.620702],
          ARRAY [-121.11712000000001, 35.623428],
          ARRAY [-121.11519799999999, 35.623374999999996],
          ARRAY [-121.10806599999998, 35.628546],
          ARRAY [-121.100586, 35.631926],
          ARRAY [-121.100824, 35.633243],
          ARRAY [-121.097375, 35.637924],
          ARRAY [-121.09788400000001, 35.639253],
          ARRAY [-121.09414100000001, 35.641008],
          ARRAY [-121.09481800000002, 35.643451999999996],
          ARRAY [-121.09310400000001, 35.644003999999995],
          ARRAY [-121.091865, 35.650645],
          ARRAY [-121.090628, 35.651686999999995],
          ARRAY [-121.08028699999998, 35.654329],
          ARRAY [-121.074377, 35.661392],
          ARRAY [-121.067515, 35.660567],
          ARRAY [-121.06670000000001, 35.662],
          ARRAY [-121.06845200000001, 35.665794],
          ARRAY [-121.065258, 35.666208],
          ARRAY [-121.06373499999998, 35.66865],
          ARRAY [-121.062039, 35.674693999999995],
          ARRAY [-121.06372400000002, 35.675827],
          ARRAY [-121.062072, 35.678697],
          ARRAY [-121.06073700000002, 35.676877999999995],
          ARRAY [-121.054781, 35.675439],
          ARRAY [-121.048494, 35.670916],
          ARRAY [-121.04135400000001, 35.669309999999996],
          ARRAY [-121.03502399999999, 35.662137],
          ARRAY [-121.03064000000002, 35.661301],
          ARRAY [-121.02639299999998, 35.658173],
          ARRAY [-121.022548, 35.652514],
          ARRAY [-121.016156, 35.646605],
          ARRAY [-121.012444, 35.644935000000004],
          ARRAY [-121.001927, 35.644166999999996],
          ARRAY [-120.994664, 35.639407],
          ARRAY [-120.98060500000001, 35.634023],
          ARRAY [-120.9741, 35.627933999999996],
          ARRAY [-120.967516, 35.616985],
          ARRAY [-120.962973, 35.615158],
          ARRAY [-120.95698200000001, 35.615370999999996],
          ARRAY [-120.95541499999999, 35.613752999999996],
          ARRAY [-120.95509600000001, 35.606434],
          ARRAY [-120.952213, 35.60179],
          ARRAY [-120.946355, 35.597404],
          ARRAY [-120.92977099999999, 35.592694],
          ARRAY [-120.92711900000002, 35.585488],
          ARRAY [-120.921762, 35.582308999999995],
          ARRAY [-120.912971, 35.580971],
          ARRAY [-120.909574, 35.578137999999996],
          ARRAY [-120.91203900000001, 35.577788999999996],
          ARRAY [-120.91341000000001, 35.576378],
          ARRAY [-120.90974100000001, 35.573204],
          ARRAY [-120.912403, 35.573094999999995],
          ARRAY [-120.91081000000001, 35.570881],
          ARRAY [-120.912418, 35.568141],
          ARRAY [-120.910454, 35.567924999999995],
          ARRAY [-120.907083, 35.564218],
          ARRAY [-120.90731099999999, 35.544536],
          ARRAY [-120.914321, 35.54633],
          ARRAY [-120.923209, 35.545300999999995],
          ARRAY [-120.92939799999999, 35.547858999999995],
          ARRAY [-120.944091, 35.550746],
          ARRAY [-120.95298700000001, 35.549527999999995],
          ARRAY [-120.961851, 35.543661],
          ARRAY [-120.97275600000002, 35.542328999999995],
          ARRAY [-120.98069100000002, 35.53932],
          ARRAY [-121.007876, 35.540786],
          ARRAY [-121.017946, 35.53805],
          ARRAY [-121.02820699999998, 35.537986],
          ARRAY [-121.044805, 35.527192],
          ARRAY [-121.053437, 35.537158],
          ARRAY [-121.056436, 35.537237999999995],
          ARRAY [-121.05424900000001, 35.525966000000004],
        ARRAY
[-121.04896500000001, 35.514213999999996],
          ARRAY [-121.05235467496401, 35.5069243162072],
          ARRAY [-121.059913, 35.509671],
          ARRAY [-121.10159499999999, 35.548814],
          ARRAY [-121.105547, 35.555357],
          ARRAY [-121.103256, 35.556587],
          ARRAY [-121.107421, 35.561217],
          ARRAY [-121.11560799999998, 35.577072],
          ARRAY [-121.11846500000001, 35.578252],
          ARRAY [-121.12140799999999, 35.581613],
          ARRAY [-121.126027, 35.593058],
          ARRAY [-121.12786764474501, 35.594866374176696]
        ]);


INSERT INTO area
VALUES
    ('Test Data', ARRAY [
          ARRAY [-121.12786764474501, 35.594866374176696],
          ARRAY [-121.125593, 35.595427],
          ARRAY [-121.12764199999998, 35.598861],
          ARRAY [-121.122304, 35.599754],
          ARRAY [-121.123989, 35.611579],
          ARRAY [-121.12178899999999, 35.613671],
          ARRAY [-121.119857, 35.613461],
          ARRAY [-121.114018, 35.619614999999996],
          ARRAY [-121.117086, 35.618412],
          ARRAY [-121.117927, 35.620702],
          ARRAY [-121.11712000000001, 35.623428],
          ARRAY [-121.11519799999999, 35.623374999999996],
          ARRAY [-121.10806599999998, 35.628546],
          ARRAY [-121.100586, 35.631926],
          ARRAY [-121.100824, 35.633243],
          ARRAY [-121.097375, 35.637924],
          ARRAY [-121.09788400000001, 35.639253],
          ARRAY [-121.09414100000001, 35.641008],
          ARRAY [-121.09481800000002, 35.643451999999996],
          ARRAY [-121.09310400000001, 35.644003999999995],
          ARRAY [-121.091865, 35.650645],
          ARRAY [-121.090628, 35.651686999999995],
          ARRAY [-121.08028699999998, 35.654329],
          ARRAY [-121.074377, 35.661392],
          ARRAY [-121.067515, 35.660567],
          ARRAY [-121.06670000000001, 35.662],
          ARRAY [-121.06845200000001, 35.665794],
          ARRAY [-121.065258, 35.666208],
          ARRAY [-121.06373499999998, 35.66865],
          ARRAY [-121.062039, 35.674693999999995],
          ARRAY [-121.06372400000002, 35.675827],
          ARRAY [-121.062072, 35.678697],
          ARRAY [-121.06073700000002, 35.676877999999995],
          ARRAY [-121.054781, 35.675439],
          ARRAY [-121.048494, 35.670916],
          ARRAY [-121.04135400000001, 35.669309999999996],
          ARRAY [-121.03502399999999, 35.662137],
          ARRAY [-121.03064000000002, 35.661301],
          ARRAY [-121.02639299999998, 35.658173],
          ARRAY [-121.022548, 35.652514],
          ARRAY [-121.016156, 35.646605],
          ARRAY [-121.012444, 35.644935000000004],
          ARRAY [-121.001927, 35.644166999999996],
          ARRAY [-120.994664, 35.639407],
          ARRAY [-120.98060500000001, 35.634023],
          ARRAY [-120.9741, 35.627933999999996],
          ARRAY [-120.967516, 35.616985],
          ARRAY [-120.962973, 35.615158],
          ARRAY [-120.95698200000001, 35.615370999999996],
          ARRAY [-120.95541499999999, 35.613752999999996],
          ARRAY [-120.95509600000001, 35.606434],
          ARRAY [-120.952213, 35.60179],
          ARRAY [-120.946355, 35.597404],
          ARRAY [-120.92977099999999, 35.592694],
          ARRAY [-120.92711900000002, 35.585488],
          ARRAY [-120.921762, 35.582308999999995],
          ARRAY [-120.912971, 35.580971],
          ARRAY [-120.909574, 35.578137999999996],
          ARRAY [-120.91203900000001, 35.577788999999996],
          ARRAY [-120.91341000000001, 35.576378],
          ARRAY [-120.90974100000001, 35.573204],
          ARRAY [-120.912403, 35.573094999999995],
          ARRAY [-120.91081000000001, 35.570881],
          ARRAY [-120.912418, 35.568141],
          ARRAY [-120.910454, 35.567924999999995],
          ARRAY [-120.907083, 35.564218],
          ARRAY [-120.90731099999999, 35.544536],
          ARRAY [-120.914321, 35.54633],
          ARRAY [-120.923209, 35.545300999999995],
          ARRAY [-120.92939799999999, 35.547858999999995],
          ARRAY [-120.944091, 35.550746],
          ARRAY [-120.95298700000001, 35.549527999999995],
          ARRAY [-120.961851, 35.543661],
          ARRAY [-120.97275600000002, 35.542328999999995],
          ARRAY [-120.98069100000002, 35.53932],
          ARRAY [-121.007876, 35.540786],
          ARRAY [-121.017946, 35.53805],
          ARRAY [-121.02820699999998, 35.537986],
          ARRAY [-121.044805, 35.527192],
          ARRAY [-121.053437, 35.537158],
          ARRAY [-121.056436, 35.537237999999995],
          ARRAY [-121.05424900000001, 35.525966000000004],
        ARRAY
[-121.04896500000001, 35.514213999999996],
          ARRAY [-121.05235467496401, 35.5069243162072],
          ARRAY [-121.059913, 35.509671],
          ARRAY [-121.10159499999999, 35.548814],
          ARRAY [-121.105547, 35.555357],
          ARRAY [-121.103256, 35.556587],
          ARRAY [-121.107421, 35.561217],
          ARRAY [-121.11560799999998, 35.577072],
          ARRAY [-121.11846500000001, 35.578252],
          ARRAY [-121.12140799999999, 35.581613],
          ARRAY [-121.126027, 35.593058],
          ARRAY [-121.12786764474501, 35.594866374176696]
        ]);

INSERT INTO point
VALUES
    (1, -120.6912, 35.2659)

INSERT INTO location
VALUES
    ('Laguna Lake', 'WaterSources', 1);
